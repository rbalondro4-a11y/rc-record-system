<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Record System</title>
    <style>
        :root { --brand: #FF6B00; --sidebar-bg: #111111; --body-bg: #f4f6f9; --dark-btn: #2c3e50; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; background: var(--body-bg); height: 100vh; overflow: hidden; }

        /* --- LOGIN --- */
        #login-overlay { position: fixed; inset: 0; background: var(--sidebar-bg); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 40px; border-radius: 12px; width: 320px; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .login-box button { width: 100%; background: var(--brand); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* --- LAYOUT --- */
        .header-bar { height: 60px; background: #000; display: flex; align-items: center; padding: 0 20px; z-index: 1200; border-bottom: 1px solid #222; }
        #menu-toggle { background: var(--brand); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .app-container { display: flex; flex: 1; overflow: hidden; display: none; }

        aside { width: 280px; background: var(--sidebar-bg); display: flex; flex-direction: column; padding: 20px; transition: margin-left 0.3s ease; color: white; }
        aside.collapsed { margin-left: -280px; }
        main { flex: 1; padding: 30px; overflow-y: auto; }

        .brand-text { color: var(--brand); font-size: 24px; font-weight: bold; text-transform: uppercase; margin-bottom: 30px; }
        nav { flex: 1; }
        .nav-btn { width: 100%; background: transparent; border: none; color: #fff; padding: 14px; text-align: left; cursor: pointer; display: flex; align-items: center; gap: 12px; border-radius: 8px; margin-bottom: 5px; }
        .nav-btn.active { background: var(--brand); font-weight: bold; }
        
        .sidebar-footer { border-top: 1px solid #333; padding-top: 15px; }
        .backup-btn { width: 100%; background: var(--dark-btn); color: white; border: none; padding: 10px; border-radius: 6px; margin-bottom: 8px; cursor: pointer; font-size: 13px; }

        /* --- TABLES & CARDS --- */
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; position: relative; }
        .input-row { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; background: #fff8f2; padding: 15px; border-radius: 8px; align-items: center; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; flex: 1; min-width: 120px; }
        .save-btn { background: var(--brand); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* Action Buttons */
        .action-btns { position: absolute; top: 25px; right: 25px; display: flex; gap: 8px; }
        .tool-btn { padding: 6px 12px; font-size: 12px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; color: white; }
        .btn-print { background: #555; }
        .btn-dl { background: #28a745; }

        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        .section { display: none; }
        .section.active { display: block; }

        .att-nav { background: var(--brand); color: white; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .status-select { border: 2px solid #000; border-radius: 8px; padding: 5px; width: 130px; font-weight: bold; }

        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
            .action-btns, aside, .header-bar, .input-row, .att-nav { display: none !important; }
        }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2 style="color: var(--brand)">RC RECORD SYSTEM</h2>
        <input type="text" id="user" placeholder="Username">
        <input type="password" id="pass" placeholder="Password">
        <button onclick="handleLogin()">ACCESS SYSTEM</button>
        <p id="login-err" style="color:red; font-size: 12px; margin-top: 10px;"></p>
    </div>
</div>

<div class="header-bar">
    <button id="menu-toggle" onclick="toggleSidebar()">‚ò∞ MENU</button>
</div>

<div class="app-container" id="app-body">
    <aside id="sidebar">
        <div class="brand-text">RC RECORD<br>SYSTEM</div>
        <nav>
            <button class="nav-btn active" onclick="switchTab('inventory', this)">üì¶ Add Product</button>
            <button class="nav-btn" onclick="switchTab('orders', this)">üëï Custom Orders</button>
            <button class="nav-btn" onclick="switchTab('sales', this)">üí∏ Daily Sales History</button>
            <button class="nav-btn" onclick="switchTab('staff', this)">üë§ Staff & Payroll</button>
        </nav>
        <div class="sidebar-footer">
            <button class="backup-btn" onclick="exportData()">üì§ Export Full Backup</button>
            <button class="backup-btn" onclick="document.getElementById('fileIn').click()">üì• Import Data</button>
            <input type="file" id="fileIn" style="display:none" onchange="importData(this)">
        </div>
    </aside>

    <main>
        <section id="inventory" class="section active">
            <div class="card print-area" id="inv-card">
                <h3>üì¶ Inventory</h3>
                <div class="action-btns">
                    <button class="tool-btn btn-print" onclick="printSection('inv-card')">üìÑ Print</button>
                    <button class="tool-btn btn-dl" onclick="downloadFeatureCSV('inventory')">üì• CSV</button>
                </div>
                <div class="input-row">
                    <input type="text" id="p-name" placeholder="Item Name">
                    <input type="number" id="p-qty" placeholder="Stock">
                    <input type="number" id="p-price" placeholder="Price">
                    <button class="save-btn" onclick="addInv()">Add</button>
                </div>
                <table id="tbl-inv"><thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Action</th></tr></thead><tbody></tbody></table>
            </div>
        </section>

        <section id="orders" class="section">
            <div class="card print-area" id="ord-card">
                <h3>üëï Custom Orders</h3>
                <div class="action-btns">
                    <button class="tool-btn btn-print" onclick="printSection('ord-card')">üìÑ Print</button>
                    <button class="tool-btn btn-dl" onclick="downloadFeatureCSV('orders')">üì• CSV</button>
                </div>
                <div class="input-row">
                    <input type="text" id="o-client" placeholder="Client Name">
                    <input type="number" id="o-qty" placeholder="Qty" oninput="calcOrder()">
                    <input type="number" id="o-unit" placeholder="Unit Price" oninput="calcOrder()">
                    <input type="number" id="o-paid" placeholder="Downpayment" oninput="calcOrder()">
                    <div style="font-weight:bold; color:var(--brand); min-width:120px;">Bal: <span id="o-bal">‚Ç±0</span></div>
                    <button class="save-btn" onclick="addOrder()">Save</button>
                </div>
                <table id="tbl-ord"><thead><tr><th>Client</th><th>Qty</th><th>Total</th><th>Paid</th><th>Balance</th><th>Action</th></tr></thead><tbody></tbody></table>
            </div>
        </section>

        <section id="sales" class="section">
            <div class="card print-area" id="sal-card">
                <h3>üí∏ Daily Sales</h3>
                <div class="action-btns">
                    <button class="tool-btn btn-print" onclick="printSection('sal-card')">üìÑ Print</button>
                    <button class="tool-btn btn-dl" onclick="downloadFeatureCSV('sales')">üì• CSV</button>
                </div>
                <div class="input-row">
                    <select id="sale-item"></select>
                    <input type="number" id="sale-qty" placeholder="Qty">
                    <button class="save-btn" onclick="processSale()">Confirm Sale</button>
                </div>
                <table id="tbl-sales"><thead><tr><th>Date</th><th>Item</th><th>Qty</th><th>Total</th></tr></thead><tbody></tbody></table>
            </div>
        </section>

        <section id="staff" class="section">
            <div class="card print-area" id="staff-card">
                <h3>üë§ Staff & Payroll</h3>
                <div class="action-btns">
                    <button class="tool-btn btn-print" onclick="printSection('staff-card')">üìÑ Print</button>
                    <button class="tool-btn btn-dl" onclick="downloadFeatureCSV('staff')">üì• CSV</button>
                </div>
                <div class="input-row">
                    <input type="text" id="s-name" placeholder="Name">
                    <input type="number" id="s-rate" placeholder="Daily Rate">
                    <button class="save-btn" onclick="addStaff()">Hire</button>
                </div>
                <div class="att-nav">
                    <button onclick="changeDate(-1)" style="cursor:pointer; color:white; background:none; border:none;">‚óÄ Prev</button>
                    <input type="date" id="att-date" onchange="render()" style="max-width:150px; border:none; border-radius:4px;">
                    <button onclick="changeDate(1)" style="cursor:pointer; color:white; background:none; border:none;">Next ‚ñ∂</button>
                </div>
                <table id="tbl-staff">
                    <thead><tr><th>Name</th><th>Rate</th><th>Status</th><th>Accrued Total</th><th>Action</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="card print-area" id="history-card">
                <h3>üìÖ Attendance List History</h3>
                <div class="action-btns">
                    <button class="tool-btn btn-print" onclick="printSection('history-card')">üìÑ Print</button>
                    <button class="tool-btn btn-dl" onclick="downloadFeatureCSV('history')">üì• CSV</button>
                </div>
                <table id="tbl-history">
                    <thead><tr style="background:#f8f9fa;"><th>Date</th><th>Name</th><th>Status</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </main>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('RC_DB_MASTER_V1')) || { inv: [], ord: [], sal: [], staff: [], att: {} };

    const sync = () => { localStorage.setItem('RC_DB_MASTER_V1', JSON.stringify(db)); render(); };
    const peso = (n) => '‚Ç±' + (n || 0).toLocaleString();

    function handleLogin() {
        if(document.getElementById('user').value === "admin" && document.getElementById('pass').value === "rc123") {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app-body').style.display = 'flex';
            document.getElementById('att-date').valueAsDate = new Date();
            render();
        } else { document.getElementById('login-err').innerText = "Wrong Credentials"; }
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }
    function switchTab(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active'); btn.classList.add('active');
    }

    // Logic Functions
    function addInv() { const n = document.getElementById('p-name').value, q = parseInt(document.getElementById('p-qty').value), p = parseFloat(document.getElementById('p-price').value); if(n && q) { db.inv.push({n, q, p}); sync(); } }
    function calcOrder() { const q = parseFloat(document.getElementById('o-qty').value) || 0, u = parseFloat(document.getElementById('o-unit').value) || 0, d = parseFloat(document.getElementById('o-paid').value) || 0; document.getElementById('o-bal').innerText = peso((q * u) - d); }
    function addOrder() { const c = document.getElementById('o-client').value, q = parseInt(document.getElementById('o-qty').value), u = parseFloat(document.getElementById('o-unit').value), d = parseFloat(document.getElementById('o-paid').value) || 0; if(c && q) { db.ord.push({c, q, total: q*u, paid: d}); sync(); } }
    function processSale() {
        const i = document.getElementById('sale-item').value, q = parseInt(document.getElementById('sale-qty').value);
        if(i !== "" && q > 0) {
            const item = db.inv[i];
            if(item.q >= q) { item.q -= q; db.sal.push({d: new Date().toLocaleDateString(), n: item.n, q, t: q * item.p}); sync(); }
            else { alert("No Stock"); }
        }
    }
    function addStaff() { const n = document.getElementById('s-name').value, r = parseFloat(document.getElementById('s-rate').value); if(n && r) { db.staff.push({n, r}); sync(); } }
    function changeDate(days) { let current = new Date(document.getElementById('att-date').value); current.setDate(current.getDate() + days); document.getElementById('att-date').valueAsDate = current; render(); }
    function updateAttendance(name, status) { let date = document.getElementById('att-date').value; if(!db.att[date]) db.att[date] = {}; db.att[date][name] = status; sync(); }
    
    function calculateAccrued(name, rate) {
        let total = 0;
        for (let date in db.att) {
            let s = db.att[date][name];
            if(s === 'Full') total += rate;
            if(s === 'Half') total += (rate * 0.5);
            if(s === 'Undertime') total += (rate * 0.85);
        }
        return total;
    }

    function render() {
        const iT = document.querySelector('#tbl-inv tbody'), oT = document.querySelector('#tbl-ord tbody'), sT = document.querySelector('#tbl-sales tbody'), stT = document.querySelector('#tbl-staff tbody'), hT = document.querySelector('#tbl-history tbody'), sel = document.getElementById('sale-item');
        const activeDate = document.getElementById('att-date').value;
        iT.innerHTML = ''; oT.innerHTML = ''; sT.innerHTML = ''; stT.innerHTML = ''; hT.innerHTML = ''; sel.innerHTML = '<option value="">Select...</option>';
        
        db.inv.forEach((x, i) => { iT.innerHTML += `<tr><td>${x.n}</td><td>${x.q}</td><td>${peso(x.p)}</td><td><button onclick="db.inv.splice(${i},1);sync()">üóëÔ∏è</button></td></tr>`; sel.innerHTML += `<option value="${i}">${x.n} (${x.q})</option>`; });
        db.ord.forEach((x, i) => { oT.innerHTML += `<tr><td>${x.c}</td><td>${x.q}</td><td>${peso(x.total)}</td><td>${peso(x.paid)}</td><td style="color:red">${peso(x.total-x.paid)}</td><td><button onclick="db.ord.splice(${i},1);sync()">üóëÔ∏è</button></td></tr>`; });
        db.sal.forEach(x => { sT.innerHTML += `<tr><td>${x.d}</td><td>${x.n}</td><td>${x.q}</td><td>${peso(x.t)}</td></tr>`; });
        db.staff.forEach((x, i) => {
            let status = (db.att[activeDate] && db.att[activeDate][x.n]) ? db.att[activeDate][x.n] : '-';
            stT.innerHTML += `<tr><td><b>${x.n}</b></td><td>${peso(x.r)}</td><td><select class="status-select" onchange="updateAttendance('${x.n}', this.value)"><option value="-" ${status==='-'?'selected':''}>-</option><option value="Full" ${status==='Full'?'selected':''}>Full</option><option value="Half" ${status==='Half'?'selected':''}>Half</option><option value="Undertime" ${status==='Undertime'?'selected':''}>Undertime</option><option value="Close" ${status==='Close'?'selected':''}>Close</option></select></td><td style="color:green; font-weight:bold;">${peso(calculateAccrued(x.n, x.r))}</td><td><button onclick="db.staff.splice(${i},1);sync()">üóëÔ∏è</button></td></tr>`;
        });
        Object.keys(db.att).sort().reverse().forEach(d => { for(let name in db.att[d]) hT.innerHTML += `<tr><td>${d}</td><td>${name}</td><td><b>${db.att[d][name]}</b></td></tr>`; });
    }

    function printSection(id) { window.print(); }

    function downloadFeatureCSV(feature) {
        let csv = "";
        if (feature === 'inventory') {
            csv = "Item Name,Quantity,Price\n";
            db.inv.forEach(x => csv += `"${x.n}",${x.q},${x.p}\n`);
        } else if (feature === 'orders') {
            csv = "Client,Quantity,Total,Paid,Balance\n";
            db.ord.forEach(x => csv += `"${x.c}",${x.q},${x.total},${x.paid},${x.total - x.paid}\n`);
        } else if (feature === 'sales') {
            csv = "Date,Item Name,Quantity,Total Sales\n";
            db.sal.forEach(x => csv += `${x.d},"${x.n}",${x.q},${x.t}\n`);
        } else if (feature === 'staff') {
            csv = "Name,Daily Rate,Accrued Salary\n";
            db.staff.forEach(x => csv += `"${x.n}",${x.r},${calculateAccrued(x.n, x.r)}\n`);
        } else if (feature === 'history') {
            csv = "Date,Name,Status\n";
            Object.keys(db.att).forEach(d => { for(let n in db.att[d]) csv += `${d},"${n}",${db.att[d][n]}\n`; });
        }
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `RC_${feature}_Report.csv`;
        a.click();
    }

    function exportData() { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(db)], {type:'application/json'})); a.download="RC_FULL_BACKUP.json"; a.click(); }
    function importData(input) { const r = new FileReader(); r.onload=(e)=>{ db=JSON.parse(e.target.result); sync(); alert("Restored!"); }; r.readAsText(input.files[0]); }
</script>
</body>
</html>

