<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC RECORD SYSTEM</title>
    <style>
        :root {
            --brand: #FF6B00;
            --sidebar-bg: #111111;
            --card-bg: #ffffff;
            --body-bg: #f4f6f9;
            --success: #28a745;
            --danger: #dc3545;
            --info: #007bff;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--body-bg); margin: 0; color: #333; }
        
        /* LOGIN SYSTEM */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--sidebar-bg); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 40px; border-radius: 12px; width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .login-box button { width: 100%; background: var(--brand); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        #app-content { display: none; } 
        .wrapper { display: flex; }

        /* SIDEBAR */
        aside { width: 250px; background: var(--sidebar-bg); height: 100vh; position: fixed; color: white; padding: 25px; box-sizing: border-box; z-index: 100; display: flex; flex-direction: column; }
        aside h2 { color: var(--brand); margin-bottom: 30px; font-size: 20px; text-transform: uppercase; letter-spacing: 2px; }
        .nav-btn { width: 100%; padding: 12px; margin-bottom: 12px; border: none; background: transparent; color: #999; text-align: left; cursor: pointer; border-radius: 6px; }
        .nav-btn.active { background: var(--brand); color: white; font-weight: bold; }

        /* MAIN CONTENT */
        main { margin-left: 250px; padding: 40px; width: 100%; box-sizing: border-box; }
        .section { display: none; margin-bottom: 30px; }
        .section.active { display: block; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--brand); }
        .stat-card p { margin: 10px 0 0; font-size: 20px; font-weight: 700; }

        /* CARDS & TABLES */
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; margin-bottom: 15px; padding-bottom: 10px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; background: #fff8f2; padding: 15px; border-radius: 8px; align-items: center; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 6px; flex: 1; min-width: 100px; }
        
        .action-btn { background: var(--brand); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .edit-btn { background: var(--info); color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; }
        .del-btn { background: #666; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; background: #fafafa; color: #666; font-size: 13px; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }

        /* STATUSES */
        .stat-pending { background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .stat-delivered { background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .badge-present { background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .badge-absent { background: #ffebee; color: #c62828; padding: 4px 8px; border-radius: 4px; font-weight: bold; }

        @media print {
            aside, .no-print, .input-group, button, #login-overlay { display: none !important; }
            main { margin-left: 0 !important; padding: 0 !important; }
            .section { display: none !important; }
            .section.print-focus { display: block !important; }
        }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2>RC RECORD SYSTEM LOGIN</h2>
        <input type="text" id="user" placeholder="Username">
        <input type="password" id="pass" placeholder="Password">
        <button onclick="handleLogin()">ACCESS DASHBOARD</button>
        <p id="err" style="color:red; font-size: 12px;"></p>
    </div>
</div>

<div id="app-content">
    <div class="wrapper">
        <aside class="no-print">
            <h2>RC RECORD SYSTEM</h2>
            <button class="nav-btn active" onclick="switchSection('inventory', this)">üì¶ Add Product</button>
            <button class="nav-btn" onclick="switchSection('uniforms', this)">üëï Custom Orders</button>
            <button class="nav-btn" onclick="switchSection('sales', this)">üí∏ Daily Sales History</button>
            <button class="nav-btn" onclick="switchSection('staff', this)">üë§ Staff & Payroll</button>
            
            <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid #333;">
                <p style="font-size: 10px; color: #666; margin-bottom: 10px;">MASTER BACKUP</p>
                <button class="nav-btn" onclick="exportMasterDB()" style="background: #2c3e50; color: white; padding: 8px;">üì§ Export Data</button>
                <button class="nav-btn" onclick="document.getElementById('importFile').click()" style="background: #2c3e50; color: white; padding: 8px;">üì• Import Data</button>
                <input type="file" id="importFile" style="display:none" onchange="importMasterDB(this)">
                
                <hr style="border: 0; border-top: 1px solid #333; margin: 15px 0;">
                <button class="nav-btn" onclick="window.print()" style="background: var(--brand); color: white;">üìÑ PRINT REPORT</button>
                <button class="nav-btn" onclick="softLogout()" style="background: #333; color: white;">üö™ LOGOUT</button>
            </div>
        </aside>

        <main>
            <div class="stats-grid no-print">
                <div class="stat-card"><h4>Stock</h4><p id="dash-stock">0</p></div>
                <div class="stat-card"><h4>Revenue</h4><p id="dash-rev">‚Ç±0.00</p></div>
                <div class="stat-card"><h4>Payroll</h4><p id="dash-pay">‚Ç±0.00</p></div>
            </div>

            <section id="inventory" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h3>Inventory</h3>
                        <button class="action-btn no-print" style="padding:5px 10px; font-size:12px;" onclick="downloadTarget('table-inventory', 'Inventory')">Download CSV</button>
                    </div>
                    <div class="input-group no-print">
                        <input type="text" id="inv-name" placeholder="Item Name">
                        <input type="number" id="inv-qty" placeholder="Qty">
                        <input type="number" id="inv-price" placeholder="Price">
                        <button class="action-btn" onclick="addInventory()">Add Product</button>
                    </div>
                    <table id="table-inventory">
                        <thead><tr><th>Item</th><th>Stock</th><th>Price</th><th class="no-print">Actions</th></tr></thead>
                        <tbody id="body-inventory"></tbody>
                    </table>
                </div>
            </section>

            <section id="uniforms" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>Job Orders</h3>
                        <button class="action-btn no-print" style="padding:5px 10px; font-size:12px;" onclick="downloadTarget('table-uniforms', 'Job_Orders')">Download CSV</button>
                    </div>
                    <div class="input-group no-print">
                        <input type="text" id="u-client" placeholder="Client">
                        <input type="text" id="u-desc" placeholder="Details">
                        <input type="number" id="u-qty" placeholder="Qty" oninput="calcJobTotal()">
                        <input type="number" id="u-unit-price" placeholder="Unit Price" oninput="calcJobTotal()">
                        <input type="number" id="u-down" placeholder="Downpayment" oninput="calcJobTotal()">
                        <div style="background:#fff; padding:10px; border-radius:6px; border:1px solid #ddd; font-weight:bold; color:var(--brand); font-size: 12px;">
                            Total: <span id="u-total-display">‚Ç±0.00</span> | Balance: <span id="u-balance-display">‚Ç±0.00</span>
                        </div>
                        <button class="action-btn" onclick="addUniform()">Save Order</button>
                    </div>
                    <table id="table-uniforms">
                        <thead><tr><th>Client</th><th>Details</th><th>Qty</th><th>Total</th><th>Paid</th><th>Balance</th><th>Status</th><th class="no-print">Actions</th></tr></thead>
                        <tbody id="body-uniforms"></tbody>
                    </table>
                </div>
            </section>

            <section id="sales" class="section">
                <div class="card">
                    <div class="card-header"><h3>Sales History</h3></div>
                    <div class="input-group no-print">
                        <select id="sale-select"></select>
                        <input type="number" id="sale-qty" placeholder="Qty">
                        <button class="action-btn" onclick="processSale()">Confirm Sale</button>
                    </div>
                    <table id="table-sales">
                        <thead><tr><th>Date</th><th>Item</th><th>Qty</th><th>Total</th><th class="no-print">Actions</th></tr></thead>
                        <tbody id="body-sales"></tbody>
                    </table>
                </div>
            </section>

            <section id="staff" class="section">
                <div class="card no-print">
                    <h3>Manage Staff</h3>
                    <div class="input-group">
                        <input type="text" id="staff-name" placeholder="Name">
                        <input type="number" id="staff-rate" placeholder="Daily Rate">
                        <button class="action-btn" onclick="addStaff()">Hire</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Daily Attendance & Payroll</h3>
                    <div class="input-group no-print">
                        <input type="date" id="attendance-date">
                    </div>
                    <table id="table-staff-master">
                        <thead><tr><th>Name</th><th>Rate</th><th>Days</th><th>Salary</th><th class="no-print">Actions</th></tr></thead>
                        <tbody id="body-staff-master"></tbody>
                    </table>
                </div>
                <div class="card">
                    <h3>Attendance Logs</h3>
                    <table id="table-history">
                        <thead><tr><th>Date</th><th>Present</th><th>Absent</th><th class="no-print">Del</th></tr></thead>
                        <tbody id="body-history"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
</div>

<script>
    // --- AUTH & PERSISTENCE ---
    function handleLogin() {
        if(document.getElementById('user').value === "admin" && document.getElementById('pass').value === "pulse123") {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            render();
        } else { document.getElementById('err').innerText = "‚ùå Denied"; }
    }

    function softLogout() {
        document.getElementById('login-overlay').style.display = 'flex';
        document.getElementById('app-content').style.display = 'none';
        document.getElementById('pass').value = "";
    }

    // Database Key
    const DB_KEY = 'PulseMaster_V2';

    // Load Data
    let db = JSON.parse(localStorage.getItem(DB_KEY)) || { 
        inventory: [], sales: [], uniforms: [], staff: [], history: {} 
    };

    function sync() {
        localStorage.setItem(DB_KEY, JSON.stringify(db));
        render();
    }

    // --- NEW BACKUP SYSTEM ---
    function exportMasterDB() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db, null, 2));
        const downloadAnchorNode = document.createElement('a');
        const date = new Date().toISOString().slice(0,10);
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "PULSE_BACKUP_" + date + ".json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importMasterDB(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (confirm("This will replace current data. Proceed?")) {
                    db = importedData;
                    sync();
                    alert("Import Successful!");
                }
            } catch (err) {
                alert("Error: Invalid Backup File");
            }
        };
        reader.readAsText(file);
    }

    // --- CORE LOGIC ---
    const peso = (n) => '‚Ç±' + (n || 0).toLocaleString('en-PH', { minimumFractionDigits: 2 });

    function calcJobTotal() {
        const q = parseFloat(document.getElementById('u-qty').value) || 0;
        const p = parseFloat(document.getElementById('u-unit-price').value) || 0;
        const d = parseFloat(document.getElementById('u-down').value) || 0;
        document.getElementById('u-total-display').innerText = peso(q * p);
        document.getElementById('u-balance-display').innerText = peso((q * p) - d);
    }

    function addInventory() {
        const n = document.getElementById('inv-name').value, q = parseInt(document.getElementById('inv-qty').value), p = parseFloat(document.getElementById('inv-price').value);
        if (n && q) { db.inventory.push({ name: n, qty: q, price: p }); sync(); }
    }
    
    function addUniform() {
        const c = document.getElementById('u-client').value, d = document.getElementById('u-desc').value, q = parseInt(document.getElementById('u-qty').value) || 0, up = parseFloat(document.getElementById('u-unit-price').value) || 0, dp = parseFloat(document.getElementById('u-down').value) || 0;
        if (c && q > 0) { 
            db.uniforms.push({ client: c, desc: d, qty: q, unitPrice: up, total: q * up, down: dp, status: 'PENDING' }); 
            sync(); 
        }
    }

    function processSale() {
        const i = document.getElementById('sale-select').value, q = parseInt(document.getElementById('sale-qty').value);
        if (i !== "" && q > 0) {
            const item = db.inventory[i];
            if (item.qty >= q) {
                item.qty -= q;
                db.sales.push({ date: new Date().toLocaleDateString(), name: item.name, qty: q, total: q * item.price });
                sync();
            }
        }
    }

    function addStaff() {
        const n = document.getElementById('staff-name').value, r = parseFloat(document.getElementById('staff-rate').value);
        if (n && r) { db.staff.push({ name: n, rate: r }); sync(); }
    }

    function markAttendance(name, status) {
        const d = document.getElementById('attendance-date').value;
        if(!d) return alert("Select Date");
        if (!db.history[d]) db.history[d] = { present: [], absent: [] };
        db.history[d].present = db.history[d].present.filter(n => n !== name);
        db.history[d].absent = db.history[d].absent.filter(n => n !== name);
        db.history[d][status].push(name);
        sync();
    }

    // --- UI RENDER ---
    function render() {
        const invT = document.getElementById('body-inventory'), uniT = document.getElementById('body-uniforms'), saleT = document.getElementById('body-sales'), sel = document.getElementById('sale-select'), staffMastT = document.getElementById('body-staff-master'), histT = document.getElementById('body-history');
        let tStock = 0, tRev = 0, tPay = 0;

        invT.innerHTML = ''; sel.innerHTML = '<option value="">Select...</option>';
        db.inventory.forEach((p, i) => {
            invT.innerHTML += `<tr><td>${p.name}</td><td>${p.qty}</td><td>${peso(p.price)}</td><td class="no-print"><button class="del-btn" onclick="db.inventory.splice(${i},1); sync();">üóëÔ∏è</button></td></tr>`;
            sel.innerHTML += `<option value="${i}">${p.name} (${p.qty})</option>`;
            tStock += p.qty;
        });

        uniT.innerHTML = '';
        db.uniforms.forEach((u, i) => { 
            const bal = u.total - u.down;
            const sClass = (u.status === 'DELIVERED') ? 'stat-delivered' : 'stat-pending';
            uniT.innerHTML += `<tr><td>${u.client}</td><td>${u.desc}</td><td>${u.qty}</td><td>${peso(u.total)}</td><td>${peso(u.down)}</td><td style="color:${bal>0?'red':'green'}"><b>${peso(bal)}</b></td><td><span class="${sClass}" onclick="db.uniforms[${i}].status=(db.uniforms[${i}].status==='PENDING'?'DELIVERED':'PENDING'); sync();">${u.status}</span></td><td class="no-print"><button class="del-btn" onclick="db.uniforms.splice(${i},1); sync();">üóëÔ∏è</button></td></tr>`; 
        });

        saleT.innerHTML = '';
        db.sales.forEach((s, i) => { 
            saleT.innerHTML += `<tr><td>${s.date}</td><td>${s.name}</td><td>${s.qty}</td><td>${peso(s.total)}</td><td class="no-print"><button class="del-btn" onclick="db.sales.splice(${i},1); sync();">üóëÔ∏è</button></td></tr>`; 
            tRev += s.total; 
        });

        staffMastT.innerHTML = '';
        db.staff.forEach((st, i) => {
            let days = 0; for(let d in db.history) { if(db.history[d].present.includes(st.name)) days++; }
            let sal = st.rate * days; tPay += sal;
            staffMastT.innerHTML += `<tr><td><b>${st.name}</b></td><td>${peso(st.rate)}</td><td>${days}</td><td>${peso(sal)}</td><td class="no-print">
                <button class="edit-btn" style="background:green;" onclick="markAttendance('${st.name}','present')">‚úîÔ∏è</button>
                <button class="edit-btn" style="background:red;" onclick="markAttendance('${st.name}','absent')">‚ùå</button>
                <button class="del-btn" onclick="db.staff.splice(${i},1); sync();">üóëÔ∏è</button>
            </td></tr>`;
        });

        histT.innerHTML = '';
        Object.keys(db.history).sort().reverse().forEach(date => {
            histT.innerHTML += `<tr><td><b>${date}</b></td><td><span class="badge-present">${db.history[date].present.join(', ')}</span></td><td><span class="badge-absent">${db.history[date].absent.join(', ')}</span></td><td class="no-print"><button class="del-btn" onclick="delete db.history['${date}']; sync();">üóëÔ∏è</button></td></tr>`;
        });

        document.getElementById('dash-stock').innerText = tStock;
        document.getElementById('dash-rev').innerText = peso(tRev);
        document.getElementById('dash-pay').innerText = peso(tPay);
    }

    function switchSection(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active'); btn.classList.add('active');
    }

    function downloadTarget(id, title) {
        let csv = [];
        let rows = document.getElementById(id).querySelectorAll("tr");
        for (let i = 0; i < rows.length; i++) {
            let row = [], cols = rows[i].querySelectorAll("td, th");
            for (let j = 0; j < cols.length - 1; j++) row.push(cols[j].innerText.replace('‚Ç±', '').replace(',', ''));
            csv.push(row.join(","));
        }
        let downloadLink = document.createElement("a");
        let blob = new Blob(["\ufeff", csv.join("\n")], { type: "text/csv" });
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = title + ".csv";
        downloadLink.click();
    }

    document.getElementById('attendance-date').valueAsDate = new Date();
    render();
</script>

</body>
</html>
